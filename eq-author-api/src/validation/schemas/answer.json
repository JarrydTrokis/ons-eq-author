{
  "$id": "http://example.com/schemas/answer.json",
  "type": "object",
  "allOf": [
    {
      "if": {
        "properties": {
          "type": {
            "not": { "enum": ["Checkbox", "Radio"] }
          }
        }
      },
      "then": {
        "$ref": "#/definitions/basicAnswer"
      }
    },
    {
      "if": {
        "properties": {
          "type": {
            "enum": ["Number", "Percentage", "Currency", "Unit"]
          }
        }
      },
      "then": {
        "$ref": "#/definitions/numericAnswer"
      }
    },
    {
      "if": {
        "properties": {
          "type": { "const": "Checkbox" }
        }
      },
      "then": {
        "$ref": "#/definitions/checkboxAnswer"
      }
    },
    {
      "if": {
        "properties": {
          "type": { "const": "Radio" }
        }
      },
      "then": {
        "$ref": "#/definitions/radioAnswer"
      }
    },
    {
      "if": {
        "properties": {
          "type": { "const": "Date" }
        }
      },
      "then": {
        "$ref": "#/definitions/dateAnswer"
      }
    },
    {
      "if": {
        "properties": {
          "type": { "const": "DateRange" }
        }
      },
      "then": {
        "$ref": "#/definitions/dateRangeAnswer"
      }
    }
  ],
  "definitions": {
    "basicAnswer": {
      "properties": {
        "qCode": {
          "$ref": "definitions.json#/definitions/populatedString"
        },
        "label": {
          "$ref": "definitions.json#/definitions/populatedString"
        },
        "properties": {
          "$ref": "#/definitions/properties"
        }
      },
      "required": [
        "label"
      ]
    },
    "numericAnswer": {
      "properties": {
        "validation": {
          "$ref": "validation.json#/definitions/numericValidations"
        }
      }
    },
    "checkboxAnswer": {
      "properties": {
        "options": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "qCode": {
                "$ref": "definitions.json#/definitions/populatedString"
              }
            },
            "allOf": [
              {
                "$ref": "option.json"
              },
              {
                "uniquePropertyValueInArrayOfObjects": "label"
              }
            ],
            "required": ["qCode"],
            "errorMessage": {
              "required": {
                "qCode": "ERR_QCODE_REQUIRED"
              }
            }
          }
        },
        "mutuallyExclusiveOption": {
          "$ref": "option.json"
        }
      },
      "required": ["options"]
    },
    "radioAnswer": {
      "properties": {
        "qCode": {
          "$ref": "definitions.json#/definitions/populatedString"
        },
        "options": {
          "type": "array",
          "items": {
            "allOf": [
              {
                "$ref": "option.json"
              },
              {
                "uniquePropertyValueInArrayOfObjects": "label"
              }
            ]
          }
        },
        "mutuallyExclusiveOption": {
          "$ref": "option.json"
        }
      },
      "required": ["options", "qCode"],
      "errorMessage": {
        "required": {
          "qCode": "ERR_QCODE_REQUIRED"
        }
      }
    },
    "dateAnswer": {
      "properties": {
        "validation": {
          "$ref": "validation.json#/definitions/dateValidations"
        }
      }
    },
    "dateRangeAnswer": {
      "properties": {
        "secondaryQCode": {
          "$ref": "definitions.json#/definitions/populatedString"
        },
        "secondaryLabel": {
          "$ref": "definitions.json#/definitions/populatedString"
        },
        "validation": {
          "allOf": [
            {
              "if": {
                "allOf": [
                  {
                    "properties": {
                      "minDuration": {
                        "properties": {
                          "enabled": {
                            "const": true
                          }
                        }
                      }
                    }
                  },
                  {
                    "properties": {
                      "maxDuration": {
                        "properties": {
                          "enabled": {
                            "const": true
                          }
                        }
                      }
                    }
                  }
                ]
              },
              "then": {
                "properties": {
                  "minDuration": {
                    "type": "object",
                    "properties": {
                      "duration": {
                        "validateDuration": {
                          "$data": "2/maxDuration"
                        }
                      }
                    }
                  },
                  "maxDuration": {
                    "type": "object",
                    "properties": {
                      "duration": {}
                    }
                  }
                }
              }
            },
            {
              "if": {
                "allOf": [
                  {
                    "properties": {
                      "earliestDate": {
                        "properties": {
                          "enabled": {
                            "const": true
                          }
                        }
                      }
                    }
                  },
                  {
                    "properties": {
                      "latestDate": {
                        "properties": {
                          "enabled": {
                            "const": true
                          }
                        }
                      }
                    }
                  }
                ]
              },
              "then": {
                "properties": {
                  "earliestDate": {
                    "type": "object",
                    "properties": {
                      "custom": {
                        "validateLatestAfterEarliest": {
                          "$data": "2/latestDate"
                        }
                      }
                    }
                  }
                }
              }
            }
          ],
          "properties": {
            "earliestDate": {
              "anyOf": [
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": true
                    },
                    "value": {
                      "not": {
                        "type": "null"
                      }
                    },
                    "offset": {
                      "properties": {
                        "value": {
                          "not": {
                            "type": "null"
                          }
                        }
                      }
                    }
                  }
                },
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": false
                    }
                  }
                }
              ],
              "errorMessage": "ERR_NO_VALUE"
            },
            "latestDate": {
              "anyOf": [
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": true
                    },
                    "value": {
                      "not": {
                        "type": "null"
                      }
                    },
                    "offset": {
                      "properties": {
                        "value": {
                          "not": {
                            "type": "null"
                          }
                        }
                      }
                    }
                  }
                },
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": false
                    }
                  }
                }
              ],
              "errorMessage": "ERR_NO_VALUE"
            },
            "minDuration": {
              "anyOf": [
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": true
                    },
                    "value": {
                      "not": {
                        "type": "null"
                      }
                    },
                    "duration": {
                      "properties": {
                        "value": {
                          "not": {
                            "type": "null"
                          }
                        }
                      }
                    }
                  }
                },
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": false
                    }
                  }
                }
              ],
              "errorMessage": "ERR_NO_VALUE"
            },
            "maxDuration": {
              "anyOf": [
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": true
                    },
                    "value": {
                      "not": {
                        "type": "null"
                      }
                    },
                    "duration": {
                      "properties": {
                        "value": {
                          "not": {
                            "type": "null"
                          }
                        }
                      }
                    }
                  }
                },
                {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "const": false
                    }
                  }
                }
              ],
              "errorMessage": "ERR_NO_VALUE"
            }
          }
        }
      },
      "required": [
        "qCode",
        "secondaryQCode"
      ],
      "errorMessage": {
        "required": {
          "qCode": "ERR_QCODE_REQUIRED",
          "secondaryQCode": "ERR_SECONDARY_QCODE_REQUIRED"
        }
      }
    },
    "properties": {
      "type": "object",
      "properties": {
        "decimals": {
          "linkedDecimalValidation": {
            "$data": "/sections"
          }
        },
        "maxLength": {
          "type": "string",
          "textLengthInRange": "maxLength"
        },
        "unit": {
          "$ref": "definitions.json#/definitions/populatedString"
        }
      }
    }
  }
}
